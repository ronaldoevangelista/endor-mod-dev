{
  "version": 3,
  "file": "LinuxTargetHelper.js",
  "sourceRoot": "",
  "sources": [
    "../../src/targets/LinuxTargetHelper.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import { remove, emptyDir, readdir, outputFile } from \"fs-extra-p\"\nimport * as path from \"path\"\nimport { tmpdir } from \"os\"\nimport { getTempName, exec, debug } from \"../util/util\"\nimport { PlatformPackager } from \"../platformPackager\"\nimport { Promise as BluebirdPromise } from \"bluebird\"\nimport { LinuxBuildOptions } from \"../metadata\"\n\n//noinspection JSUnusedLocalSymbols\nconst __awaiter = require(\"../util/awaiter\")\n\nexport const installPrefix = \"/opt\"\n\nexport class LinuxTargetHelper {\n  readonly icons: Promise<Array<Array<string>>>\n  readonly tempDirPromise: Promise<string>\n\n  maxIconPath: string | null = null\n\n  constructor(private packager: PlatformPackager<LinuxBuildOptions>, cleanupTasks: Array<() => Promise<any>>) {\n    const tempDir = path.join(tmpdir(), getTempName(\"electron-builder-linux\"))\n    this.tempDirPromise = emptyDir(tempDir)\n      .then(() => {\n        cleanupTasks.push(() => remove(tempDir))\n        return tempDir\n      })\n\n    this.icons = this.computeDesktopIcons()\n  }\n\n  // must be name without spaces and other special characters, but not product name used\n  private async computeDesktopIcons(): Promise<Array<Array<string>>> {\n    const tempDir = await this.tempDirPromise\n    try {\n      const mappings: Array<Array<string>> = []\n      const pngIconsDir = path.join(this.packager.buildResourcesDir, \"icons\")\n      let maxSize = 0\n      for (let file of (await readdir(pngIconsDir))) {\n        if (file.endsWith(\".png\") || file.endsWith(\".PNG\")) {\n          // If parseInt encounters a character that is not a numeral in the specified radix,\n          // it returns the integer value parsed up to that point\n          try {\n            const size = parseInt(file!, 10)\n            if (size > 0) {\n              const iconPath = `${pngIconsDir}/${file}`\n              mappings.push([iconPath, `${size}x${size}/apps/${this.packager.appInfo.name}.png`])\n\n              if (size > maxSize) {\n                maxSize = size\n                this.maxIconPath = iconPath\n              }\n            }\n          }\n          catch (e) {\n            console.error(e)\n          }\n        }\n      }\n\n      return mappings\n    }\n    catch (e) {\n      return this.createFromIcns(tempDir)\n    }\n  }\n\n  async computeDesktopEntry(exec?: string, extra?: string): Promise<string> {\n    const appInfo = this.packager.appInfo\n\n    const custom = this.packager.platformSpecificBuildOptions.desktop\n    if (custom != null) {\n      return custom\n    }\n\n    const productFilename = appInfo.productFilename\n    const tempFile = path.join(await this.tempDirPromise, `${productFilename}.desktop`)\n    await outputFile(tempFile, this.packager.platformSpecificBuildOptions.desktop || `[Desktop Entry]\nName=${appInfo.productName}\nComment=${this.packager.platformSpecificBuildOptions.description || appInfo.description}\nExec=${(exec == null ? `\"${installPrefix}/${productFilename}/${productFilename}\"` : exec)}\nTerminal=false\nType=Application\nIcon=${appInfo.name}\n${extra == null ? \"\" : `${extra}\\n`}`)\n    return tempFile\n  }\n\n  private async createFromIcns(tempDir: string): Promise<Array<Array<string>>> {\n    const output = await exec(\"icns2png\", [\"-x\", \"-o\", tempDir, path.join(this.packager.buildResourcesDir, \"icon.icns\")])\n    debug(output)\n\n    //noinspection UnnecessaryLocalVariableJS\n    const imagePath = path.join(tempDir, \"icon_256x256x32.png\")\n\n    this.maxIconPath = imagePath\n\n    function resize(size: number): BluebirdPromise<any> {\n      const sizeArg = `${size}x${size}`\n      return exec(\"gm\", [\"convert\", \"-size\", sizeArg, imagePath, \"-resize\", sizeArg, path.join(tempDir, `icon_${size}x${size}x32.png`)])\n    }\n\n    const promises: Array<Promise<any>> = [resize(24), resize(96)]\n    if (!output.includes(\"is32\")) {\n      promises.push(resize(16))\n    }\n    if (!output.includes(\"ih32\")) {\n      promises.push(resize(48))\n    }\n    if (!output.toString().includes(\"icp6\")) {\n      promises.push(resize(64))\n    }\n    if (!output.includes(\"it32\")) {\n      promises.push(resize(128))\n    }\n\n    await BluebirdPromise.all(promises)\n\n    const appName = this.packager.appInfo.name\n\n    function createMapping(size: string) {\n      return [`${tempDir}/icon_${size}x${size}x32.png`, `${size}x${size}/apps/${appName}.png`]\n    }\n\n    return [\n      createMapping(\"16\"),\n      createMapping(\"24\"),\n      createMapping(\"32\"),\n      createMapping(\"48\"),\n      createMapping(\"64\"),\n      createMapping(\"96\"),\n      createMapping(\"128\"),\n      createMapping(\"256\"),\n      createMapping(\"512\"),\n    ]\n  }\n}"
  ]
}
